## $k_{kl}$ ç³»æ•°

#### ä¸€å¥è¯ç»“è®ºï¼ˆå…ˆè®°ä½ï¼‰

ç”¨æ¥æŽ§åˆ¶ KL æ•£åº¦å¤§å°ï¼Œåœ¨ LLM çš„ PPO / RLHF é‡Œï¼š
$$
k_{k l} \text { é€šå¸¸åœ¨ }[0.01,10] \text { ä¹‹é—´ }
$$

æœ€å¸¸è§ã€æœ€å®‰å…¨çš„èµ·ç‚¹ï¼š
$$
0.05 \sim 0.2
$$

### ä¸€ã€ä¸ºä»€ä¹ˆä¸æ˜¯ã€Œä»»æ„å®žæ•°ã€ï¼Ÿ

å…ˆçœ‹è¿™ä¸ªå…¬å¼ï¼š
$$
r_t^{K L}=-k_{k l} \cdot \log \frac{P}{P_{\mathrm{ref}}}
$$

æ³¨æ„ä¸‰ç‚¹ï¼š
1. $\log \frac{P}{P_{\text {ref }}}$
    - å¸¸è§èŒƒå›´ï¼š0.1~5
    - æžç«¯å¯åˆ° 10+
2. äººç±»å¥–åŠ±ï¼ˆreward modelï¼‰
    - è¿™ä¸ªå®Œæ•´åºåˆ—çš„æœ€ç»ˆå¾—åˆ†


### äºŒã€æŒ‰â€œæ•ˆæžœâ€åˆ†åŒºé—´ï¼ˆéžå¸¸å®žç”¨ï¼‰
##### ðŸŸ¢ 0 ï½ž 0.01ï¼šå‡ ä¹Žæ²¡åˆ¹è½¦ï¼ˆå±é™©ï¼‰

- KL ç½šåˆ† â‰ˆ 0
- æ¨¡åž‹ï¼š
    - å¿«é€Ÿåç¦»
    - å¥–åŠ± hacking
    - è¯­è¨€èƒ½åŠ›ä¸‹é™
- å…¸åž‹çŽ°è±¡ï¼šæ¨¡åž‹â€œå¾ˆä¼šè®¨å¥½ï¼Œä½†è¶Šæ¥è¶Šä¸åƒäººè¯â€
- âŒ å‡ ä¹Žä¸ç”¨

##### ðŸŸ¡ 0.01 ï½ž 0.1ï¼šåæ¾ï¼ˆæŽ¢ç´¢å¤šï¼‰

- å¸¸ç”¨äºŽï¼š
    - æ—©æœŸè®­ç»ƒ
    - å°æ¨¡åž‹
    - å¥–åŠ±æ¨¡åž‹è¾ƒå¼±æ—¶
- é£Žé™©ï¼šè®­ç»ƒåŽæœŸå¯èƒ½å¤±æŽ§

##### ðŸŸ¢ 0.05 ï½ž 0.2ï¼šå·¥ä¸šç”œç‚¹åŒº â­â­â­

- OpenAI / Anthropic é£Žæ ¼
- æœ€ç¨³å¦¥
- è¡¨çŽ°ï¼š
    - æœ‰æ”¹è¿›
    - ä¸ç‚¸
    - è¯­è¨€èƒ½åŠ›ä¿å¾—ä½
- âœ… é»˜è®¤é¦–é€‰

##### ðŸŸ  0.2 ï½ž 1ï¼šåç´§ï¼ˆä¿å®ˆï¼‰

- æ¨¡åž‹å˜åŒ–æ…¢
- å¥–åŠ±æ¶¨å¾—æ…¢
- å¸¸è§äºŽï¼š
    - éžå¸¸å¼ºçš„å¥–åŠ±æ¨¡åž‹
    - å¯¹å®‰å…¨æžåº¦æ•æ„Ÿçš„ä»»åŠ¡

##### ðŸ”´ 1 ï½ž 10ï¼šå‡ ä¹Žé”æ­»

- æ¨¡åž‹ï¼š
    - åŸºæœ¬ä¸åŠ¨
    - PPO â‰ˆ ç™½è·‘
- åªæœ‰åœ¨ï¼š
    - reward æžå¤§
    - æˆ–æ¨¡åž‹ç‰¹åˆ«å®¹æ˜“å´©æ—¶

### ä¸‰ã€ä¸ºä»€ä¹ˆå¾ˆå°‘è¶…è¿‡ 10ï¼Ÿ

å› ä¸ºï¼š

$$
\log \frac{P}{P_{\text {ref }}} \sim 2 \Rightarrow \text { æƒ©ç½š }=-2 k
$$

å¦‚æžœï¼š
- $k=10$
- å•ä¸ª token ç½šåˆ†ï¼ï¼20

ðŸ‘‰ ä¸€å¥è¯å‡ åä¸ª tokenï¼Œç›´æŽ¥è´Ÿçˆ†

### å››ã€çœŸå®žå·¥ç¨‹ä¸­æ€Žä¹ˆé€‰ï¼Ÿ
##### âœ… æ–¹æ³• 1ï¼šå›ºå®š + çœ‹ KL æ›²çº¿ï¼ˆç®€å•ï¼‰

ç›®æ ‡ç»éªŒå€¼ï¼š

| æŒ‡æ ‡         | ç»éªŒå®‰å…¨åŒº       |
| ---------- | ----------- |
| æ¯ token KL | 0.01 ~ 0.05 |
| æ¯å¥æ€» KL     | 1 ~ 6       |

- KL ä¸Šå‡å¤ªå¿« $\rightarrow k_{k l}$ è°ƒå¤§
- KL é•¿æœŸæŽ¥è¿‘ $0 \rightarrow \boldsymbol{k}_{k l}$ è°ƒå°

##### âœ… æ–¹æ³• 2ï¼šè‡ªé€‚åº” KLï¼ˆå¼ºçƒˆæŽ¨èï¼‰

è®¾ç½®ä¸€ä¸ªç›®æ ‡ï¼š
```
target_KL = 3
```

ç„¶åŽï¼š
- å®žé™… $\mathrm{KL}>3 \rightarrow$ å¢žå¤§ $k_{k l}$
- å®žé™… $\mathrm{KL}<3 \rightarrow$ å‡å° $k_{k l}$

ðŸ‘‰ çŽ°åœ¨å·¥ä¸šç•ŒåŸºæœ¬éƒ½è¿™ä¹ˆå¹²


### äº”ã€ä¸€ä¸ªç‰¹åˆ«ç›´è§‚çš„ä¾‹å­
å‡è®¾ï¼š
- äººç±»å¥–åŠ± $\approx+5$
- å¸¸è§ $\log$ æ¯”å€¼ $\approx 1.5$

é‚£åˆç† $k_{k l}$ æ˜¯ï¼š

$$
k_{k l} \approx \frac{5}{1.5} \approx 3
$$


ä½†è¿™æ˜¯æžé™æƒ…å†µï¼Œå®žé™…ä¼šå– $0.1 \sim 0.5$ ç»™æ¨¡åž‹ç•™ç©ºé—´ã€‚

### å…­ã€ç»ˆæžå£è¯€ï¼ˆå¯ä»¥ç›´æŽ¥èƒŒï¼‰
æ¨¡åž‹è¶Šå¤§ $\rightarrow k_{k l}$ è¶Šå°
å¥–åŠ±è¶Šå¼º $\rightarrow k_{k l}$ è¶Šå¤§
è¶Šæ€•ç‚¸ $\rightarrow k_{k l}$ è¶Šå¤§

å¥–åŠ±è¶Šé«˜ï¼šè¯´æ˜Žè®­ç»ƒçš„æ¨¡åž‹ç”Ÿæˆçš„å†…å®¹è´¨é‡å¾ˆé«˜ï¼Œé‚£è¿‡ç¨‹ä¸­çš„ token å°±å¯ä»¥ä»»æ„å‘æŒ¥ä¸€äº›
å¥–åŠ±è¶Šä½Žï¼šè¯´æ˜Žè®­ç»ƒçš„æ¨¡åž‹ç”Ÿæˆçš„å†…å®¹è´¨é‡å¾ˆä½Žï¼Œé‚£è¿‡ç¨‹ä¸­çš„ tokenï¼Œä¿å®ˆä¸€ç‚¹ï¼Œå°±æŒ‰åŽŸæ¥çš„æ¨¡åž‹èµ°å°±å¥½äº†

### ä¸ƒã€æœ€ç´§â€”å¥è¯æ€»ç»“
$k_{k l}$ æ²¡æœ‰ï¼‚ç†è®ºæ­£ç¡®å€¼ï¼‚
å®ƒåªæœ‰ä¸€ä¸ªç›®æ ‡ï¼šè®©æ¨¡åž‹ï¼‚æƒ³å˜ï¼Œä½†ä¸æ•¢ä¹±å˜ï¼‚ã€‚