## PPO é‡Œçš„ Critic Model åˆ°åº•æ˜¯å¹²å˜›çš„ï¼Ÿ
##### ä¸€å¥è¯å…ˆç»™ç»“è®º

>Critic model çš„å”¯ä¸€å·¥ä½œï¼š
å¸®æ¨¡å‹åˆ¤æ–­ä¸€å¥è¯â€œç°åœ¨çœ‹æ¥å€¼ä¸å€¼å¾—ç»§ç»­è¿™ä¹ˆè¯´â€ã€‚

- å®ƒä¸è´Ÿè´£ç”Ÿæˆæ–‡æœ¬ï¼Œ
- å®ƒä¸è´Ÿè´£åˆ¤æ–­å¥½ä¸å¥½ï¼Œ
- å®ƒåªè´Ÿè´£ä¸€ä»¶äº‹ï¼š
ğŸ‘‰ ä½ ç°åœ¨è¿™ä¸ªçŠ¶æ€ï¼Œå¤§æ¦‚è¿˜èƒ½æ‹¿å¤šå°‘æ€»åˆ†ï¼Ÿ

### ä¸€ã€PPO é‡Œå…¶å®æœ‰ä¸‰ä¸ªäººåœ¨å¹²æ´»

åœ¨ LLM + PPO é‡Œï¼Œä½ å¯ä»¥æŠŠç³»ç»Ÿæƒ³æˆä¸‰ä¸ªäººï¼š

| è§’è‰²           | å¹²ä»€ä¹ˆ            |
| ------------ | -------------- |
| Actorï¼ˆç­–ç•¥æ¨¡å‹ï¼‰  | å†³å®šä¸‹ä¸€ä¸ªè¯è¯´ä»€ä¹ˆ      |
| Criticï¼ˆä»·å€¼æ¨¡å‹ï¼‰ | ä¼°è®¡â€œè¿™æ¡è·¯æœ€åèƒ½å¾—å¤šå°‘åˆ†â€ |
| Reward Model | å¥å­è¯´å®Œåæ‰“æ€»åˆ†       |

### äºŒã€å…ˆä¸ç”¨ LLMï¼Œç”¨ä¸€ä¸ªâ€œè¯´è¯æ‰“åˆ†â€çš„æ•…äº‹

å‡è®¾æ¨¡å‹æ­£åœ¨ä¸€å¥ä¸€å¥åœ°è¯´è¯ï¼š
```
æˆ‘ | çš„ | è€æ¿ | æ˜¯ | åœŸè±†
```
ç°åœ¨è¯´åˆ°ç¬¬ 3 ä¸ªè¯ï¼š
```
æˆ‘ | çš„ | è€æ¿
```
Critic model è¦å›ç­”çš„é—®é¢˜æ˜¯ï¼šâ€œå¦‚æœæ¥ä¸‹æ¥ç»§ç»­æ­£å¸¸è¯´ï¼Œå¤§æ¦‚èƒ½æ‹¿å¤šå°‘æ€»åˆ†ï¼Ÿâ€

æ³¨æ„ï¼š
- å®ƒä¸æ˜¯åœ¨çœ‹â€œä½ åˆšæ‰è¯´å¾—å¥½ä¸å¥½â€ï¼Œ
- è€Œæ˜¯åœ¨é¢„æµ‹æœªæ¥çš„ç»“æœã€‚

### ä¸‰ã€Critic åœ¨ PPO é‡Œè¾“å‡ºçš„æ˜¯ä»€ä¹ˆï¼Ÿ

Critic è¾“å…¥ï¼š
- å½“å‰ prompt
- å·²ç»ç”Ÿæˆçš„è¯ï¼ˆåˆ°ç¬¬ t æ­¥ï¼‰

Critic è¾“å‡ºï¼š
$$
V\left(S_t\right)
$$

ä¸€ä¸ªæ•°ï¼Œæ¯”å¦‚ï¼š
- +3.2
- âˆ’1.7
- +0.4

ğŸ‘‰ å«ä¹‰éå¸¸æœ´ç´ ï¼šâ€œä»ç°åœ¨è¿™ä¸ªçŠ¶æ€å‡ºå‘ï¼Œæœ€åæ€»å¥–åŠ±å¤§æ¦‚æ˜¯å¤šå°‘â€

### å››ã€ä¸ºä»€ä¹ˆ PPO éè¦ä¸€ä¸ª Criticï¼Ÿä¸ç”¨è¡Œä¸è¡Œï¼Ÿ
#### âŒ ä¸ç”¨ Critic ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ

æ¨¡å‹åªçŸ¥é“ï¼š

- æœ€å reward model ç»™äº† +5 æˆ– âˆ’3
- ä½†ä¸çŸ¥é“ï¼š
    - æ˜¯å“ªä¸€æ­¥è¯´é”™äº†
    - è¿˜æ˜¯æ•´ä½“æ–¹å‘å°±é”™äº†

ğŸ‘‰ ç»“æœå°±æ˜¯ï¼šè®­ç»ƒæä¸ç¨³å®šï¼Œæ›´æ–°æ–¹å‘å…¨é è¿æ°”

#### âœ… æœ‰äº† Critic ä¹‹å

æ¨¡å‹åœ¨æ¯ä¸€æ­¥å¯ä»¥ç®—ï¼š
$$
\text { ä¼˜åŠ¿ }=\text { å®é™…å¾—åˆ† }- \text { Critic é¢„æµ‹ }
$$
ä¹Ÿå°±æ˜¯ï¼šâ€œä½ è¿™ä¸€æ­¥ï¼Œæ˜¯æ¯”æˆ‘åŸæœ¬é¢„æœŸå¥½ï¼Œè¿˜æ˜¯å·®ï¼Ÿâ€

### äº”ã€ç”¨çœŸå®æ•°å­—ç®—ä¸€éï¼ˆéå¸¸é‡è¦ï¼‰

å‡è®¾ä¸€æ•´å¥è¯ç»“æŸåï¼š

- reward model ç»™ï¼š

$$
r_{\mathrm{RM}}=+6
$$

- KL ç´¯ç§¯ç½šåˆ†ï¼š

$$
r_T^{K L}=-4
$$


æœ€ç»ˆæ€»åˆ†ï¼š

$$
R_T=+2
$$

#### åœ¨ç¬¬ 3 ä¸ªè¯æ—¶ï¼š
Critic ä¹‹å‰é¢„æµ‹ï¼š

$$
V\left(S_3\right)=+1.2
$$


å®é™…æœ€åæ‹¿åˆ°ï¼š

$$
R_T=+2
$$


é‚£è¿™ä¸€æ¡è½¨è¿¹çš„ï¼‚è¶…é¢„æœŸç¨‹åº¦ï¼‚æ˜¯ï¼š

$$
A_3=2-1.2=+0.8
$$


ğŸ‘‰ è¯´æ˜ï¼šè¿™æ¡è·¯èµ°å¾—æ¯”é¢„æƒ³å¥½


å¦‚æœåè¿‡æ¥ï¼š

$$
\begin{gathered}
V\left(S_3\right)=+3.5 \\
A_3=2-3.5=-1.5
\end{gathered}
$$

ğŸ‘‰ è¯´æ˜ï¼šè¿™ä¸€æ­¥ä¸è¯¥è¿™ä¹ˆèµ°

### å…­ã€Actor ç”¨ Critic æ¥å¹²ä»€ä¹ˆï¼Ÿ
Actor åœ¨ PPO æ›´æ–°æ—¶ï¼ŒçœŸæ­£å…³å¿ƒçš„æ˜¯ï¼š
å“ªäº›åŠ¨ä½œï¼‚æ¯”æˆ‘é¢„æœŸçš„å¥½ï¼‚ï¼Ÿ
- $A_t>0$ ï¼šğŸ‘‰ è¿™ä¸€æ­¥å€¼å¾—ä»¥åå¤šå¹²
- $\boldsymbol{A}_{\boldsymbol{t}}<0$ ï¼šğŸ‘‰ è¿™ä¸€æ­¥ä»¥åå°‘å¹²

Critic çš„ä½œç”¨å°±æ˜¯ç»™ Actor ä¸€ä¸ªï¼‚å¯¹ç…§é¢„æœŸï¼‚ã€‚

### ä¸ƒã€Critic è‡ªå·±æ€ä¹ˆè®­ç»ƒï¼Ÿ

Critic çš„è®­ç»ƒç›®æ ‡ä¹Ÿå¾ˆç®€å•ï¼š

$$è®© V\left(S_t\right) \approx çœŸå®æœ€ç»ˆå¾—åˆ†$$
ä¹Ÿå°±æ˜¯è¯´ï¼š
- Actor åœ¨å¤–é¢ï¼‚é—¯æ±Ÿæ¹–ï¼‚
- Critic åœ¨åé¢ä¸æ–­å¤ç›˜ï¼šï¼‚æˆ‘åˆšæ‰é¢„æµ‹å‡†ä¸å‡†ï¼Ÿï¼‚
é¢„æµ‹ä¸å‡† â†’ è°ƒæ•´å‚æ•°ã€‚

### å…«ã€åœ¨ LLM + PPO é‡Œï¼ŒCritic é€šå¸¸é•¿ä»€ä¹ˆæ ·ï¼Ÿ

éå¸¸é‡è¦çš„ä¸€ç‚¹ï¼šCritic é€šå¸¸å’Œ Actor é•¿å¾—å‡ ä¹ä¸€æ¨¡ä¸€æ ·

- åŒä¸€ä¸ª LLM backbone
- åªæ˜¯åœ¨æœ€åå¤šæ¥äº†ä¸€ä¸ªï¼š
    - value head
    - è¾“å‡º 1 ä¸ªæ•°

è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆä½ ç»å¸¸çœ‹åˆ°ï¼š

```
policy head + value head
```

### ä¹ã€Critic å’Œ Reward Model çš„æ ¹æœ¬åŒºåˆ«ï¼ˆåˆ«æ··ï¼‰

| é¡¹ç›®          | Critic         | Reward Model  |
| ----------- | -------------- | ------------- |
| è¾“å…¥          | prompt + å·²ç”Ÿæˆæ–‡æœ¬ | prompt + å®Œæ•´å›ç­” |
| è¾“å‡º          | æœªæ¥æ€»åˆ†é¢„æµ‹         | "å¥½ä¸å¥½"æ‰“åˆ†         |
| ä½•æ—¶ç”¨         | æ¯ä¸€æ­¥            | å¥å­ç»“æŸ          |
| æ˜¯å¦å‚ä¸ PPO æ›´æ–° | æ˜¯              | å¦ï¼ˆå›ºå®šï¼‰         |


### åã€ä¸€ä¸ªç‰¹åˆ«è´´åˆ‡çš„æ¯”å–»ï¼ˆè®°ä½è¿™ä¸ªï¼‰

- Actor æ˜¯å†™ä½œæ–‡çš„å­¦ç”Ÿ
- Reward Model æ˜¯æœŸæœ«é˜…å·è€å¸ˆ
- Critic æ˜¯æ—è¾¹çš„å­¦éœ¸åŒæ¡Œï¼šâ€œä½ è¿™æ ·å†™ï¼Œæœ€åå¤§æ¦‚èƒ½å¾—å¤šå°‘åˆ†ï¼Ÿâ€